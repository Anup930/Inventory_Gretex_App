<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ERP Inventory System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; padding: 20px; }
        .card { margin-bottom: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .nav-tabs .nav-link.active { background-color: #0d6efd; color: white; }
    </style>
</head>
<body>

<div class="container">
    <h2 class="text-center mb-4">Inventory & Asset ERP</h2>
    
    <ul class="nav nav-tabs mb-3" id="myTab" role="tablist">
        <li class="nav-item">
            <button class="nav-link active" id="asset-tab" data-bs-toggle="tab" data-bs-target="#asset" type="button">Add Asset</button>
        </li>
        <li class="nav-item">
            <button class="nav-link" id="txn-tab" data-bs-toggle="tab" data-bs-target="#txn" type="button">Stock Transaction</button>
        </li>
    </ul>

    <div class="tab-content" id="myTabContent">
        
        <div class="tab-pane fade show active" id="asset" role="tabpanel">
            <div class="card p-4">
                <h4>Register New Asset</h4>
                <form id="assetForm">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label>Category</label>
                            <select class="form-select" name="category" required>
                                <option value="Laptop">Laptop</option>
                                <option value="Desktop">Desktop</option>
                                <option value="Printer">Printer</option>
                                <option value="Furniture">Furniture</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label>Brand</label>
                            <input type="text" class="form-control" name="brand" required>
                        </div>
                        <div class="col-md-6">
                            <label>Model</label>
                            <input type="text" class="form-control" name="model">
                        </div>
                        <div class="col-md-6">
                            <label>Serial No</label>
                            <input type="text" class="form-control" name="serialNo">
                        </div>
                        <div class="col-12">
                            <label>Configuration (e.g. i5, 16GB)</label>
                            <input type="text" class="form-control" name="config">
                        </div>
                        <div class="col-md-6">
                            <label>Purchase Date</label>
                            <input type="date" class="form-control" name="purchaseDate">
                        </div>
                        <div class="col-md-6">
                            <label>Cost</label>
                            <input type="number" class="form-control" name="cost">
                        </div>
                        <div class="col-12">
                            <button type="submit" class="btn btn-primary w-100" id="btnAsset">Save Asset</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <div class="tab-pane fade" id="txn" role="tabpanel">
            <div class="card p-4">
                <h4>Stock IN / OUT</h4>
                <form id="txnForm">
                    <div class="row g-3">
                        <div class="col-md-4">
                            <label>Transaction Type</label>
                            <select class="form-select" name="type" required>
                                <option value="IN">IN (Purchase/Return)</option>
                                <option value="OUT">OUT (Issue/Consume)</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label>Item ID (from Stock Master)</label>
                            <input type="text" class="form-control" name="itemId" placeholder="e.g., STK-001" required>
                        </div>
                        <div class="col-md-4">
                            <label>Quantity</label>
                            <input type="number" class="form-control" name="qty" required>
                        </div>
                        <div class="col-md-6">
                            <label>Item Name (Ref)</label>
                            <input type="text" class="form-control" name="itemName">
                        </div>
                        <div class="col-md-6">
                            <label>Issued To / Vendor</label>
                            <input type="text" class="form-control" name="issuedTo">
                        </div>
                        <div class="col-12">
                            <button type="submit" class="btn btn-warning w-100" id="btnTxn">Record Transaction</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        
    </div>
    
    <div id="statusMsg" class="mt-3 alert d-none"></div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // ***************** PASTE YOUR WEB APP URL BELOW *****************
    const API_URL = "https://script.google.com/macros/s/AKfycbxzKS-wiPt4YgOb09dmuBJT4zVjPSLMosiqRX8PITmvVyhdC_XGUs0wGwABebLM1BKs/exec"; 
    // ***************************************************************

    // Helper to send data
    async function postData(data) {
        const msgBox = document.getElementById("statusMsg");
        msgBox.className = "mt-3 alert alert-info";
        msgBox.innerText = "Processing...";
        msgBox.classList.remove("d-none");

        try {
            // Using fetch with no-cors creates issues getting response text, 
            // but for this setup we use 'text/plain' to avoid OPTION preflight issues in some browsers
            const response = await fetch(API_URL, {
                method: "POST",
                body: JSON.stringify(data)
            });
            
            const result = await response.json();
            
            if(result.status === "success") {
                msgBox.className = "mt-3 alert alert-success";
                msgBox.innerText = "Success: " + result.message + (result.id ? " (ID: " + result.id + ")" : "");
                document.forms[0].reset(); // Reset form roughly
            } else {
                msgBox.className = "mt-3 alert alert-danger";
                msgBox.innerText = "Error: " + result.message;
            }
        } catch (error) {
            console.error(error);
            msgBox.className = "mt-3 alert alert-danger";
            msgBox.innerText = "Connection Failed. Check Console.";
        }
    }

    // Handle Asset Submit
    document.getElementById("assetForm").addEventListener("submit", function(e) {
        e.preventDefault();
        const formData = new FormData(e.target);
        const data = Object.fromEntries(formData.entries());
        data.action = "addAsset"; // Tell backend what to do
        postData(data);
    });

    // Handle Transaction Submit
    document.getElementById("txnForm").addEventListener("submit", function(e) {
        e.preventDefault();
        const formData = new FormData(e.target);
        const data = Object.fromEntries(formData.entries());
        data.action = "addTransaction"; // Tell backend what to do
        data.user = "WebUser"; // Hardcoded for now
        postData(data);
    });
</script>

</body>
</html>
